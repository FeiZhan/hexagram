/*! hexagram 05-11-2015 */
var HEXAGRAM=HEXAGRAM||{};HEXAGRAM.Animation=function(a){this.config=a||{interval:100},this.callback_list=[],this.timer=void 0,this.status="init"},HEXAGRAM.Animation.prototype.run=function(){var a=this;this.timer=setInterval(function(){for(var b=0;b<a.callback_list.length;++b)a.callback_list[b]()},a.config.interval),this.status="running"},HEXAGRAM.Animation.prototype.pause=function(){this.status="paused"},HEXAGRAM.Animation.prototype.clear=function(){this.callback_list=[],clearInterval(this.timer),this.timer=void 0,this.status="stopped"},HEXAGRAM.Animation.prototype.add=function(a){this.callback_list.push(a)},HEXAGRAM.Animation.prototype.remove=function(a){this.callback_list.splice(this.callback_list.indexOf(a),1)};var HEXAGRAM=HEXAGRAM||{};HEXAGRAM.CircleRing=function(a){var b=this;this.parent=a.parent;var c=2*Math.PI,d=0,e=this.parent.canvas.append("g").attr("opacity",1);this.circles=[];for(var f=0;f<a.count;++f){var g=f/a.count,h=1,i=e.append("circle");i.attr("r",0).attr("cx",a.width/2+Math.cos((d+g)*c)*h*a.radius).attr("cy",a.height/2+Math.sin((d+g)*c)*h*a.radius).attr("stroke",this.parent.styles.colors.smallRing).attr("fill","none").attr("stroke-width",.5+a.innerRadius/15);var j=i.transition().duration(this.parent.styles.animation.inSpeed).attr("r",a.innerRadius).each("end",function(){i.t=void 0});i.t=j,this.circles.push(i)}var k=function(){d=a.reverse?d-1*(a.speed||b.parent.styles.animation.animationSpeed):d+1*(a.speed||b.parent.styles.animation.animationSpeed),e.transition().ease("linear").duration(100).attr("transform","rotate("+d+", "+a.width/2+", "+a.height/2+")")};return this.parent.animation.add(k),this},HEXAGRAM.CircleRing.prototype.recolor=function(a){$.each(this.circles,function(b,c){c.attr("stroke",a)})},HEXAGRAM.CircleRing.prototype.fill=function(a){$.each(this.circles,function(b,c){c.attr("fill",a)})},HEXAGRAM.CircleRing.prototype.disperse=function(){var a=Q.defer();this.parent.animation.remove(animation),$.each(this.circles,function(a,b){b.transition().duration(500).attr("r",0)});var b=ring.transition();return b.duration(this.parent.styles.animation.inSpeed).attr("opacity",0).each("end",a.resolve,ring),a.promise};var HEXAGRAM=HEXAGRAM||{};HEXAGRAM.MagicCircle=function(a,b){this.selector=a,this.config=b||HEXAGRAM.MagicCircle.DefaultConfig,this.styles=HEXAGRAM.MagicCircle.DefaultConfig,this.id=Math.floor(1e7*Math.random()),this.height=0,this.width=0,this.defs={},this.canvas=void 0,this.animation=new HEXAGRAM.Animation,this.elements=[],this.current=void 0,this.currentRadius=0,this.init()},HEXAGRAM.MagicCircle.DefaultConfig={colors:{ring:"#182645",text:"#243a6c",smallRing:"#304f93"},type:{leading:6,typecase:"uppercase"},animation:{inSpeed:666,animationSpeed:6.66},graphics:{blur:{level:0},shadow:{level:1,distance:0}}},HEXAGRAM.MagicCircle.prototype.cast=function(){return this.run()},HEXAGRAM.MagicCircle.prototype.init=function(){this.width=$(this.selector).width(),this.height=$(this.selector).height(),this.canvas=d3.select(this.selector).append("svg").attr("width",this.width).attr("height",this.height).attr("class","main").attr("shape-rendering","optimizeSpeed"),this.defs=this.canvas.append("defs");var a=this.defs.append("filter").attr("id","drop-blur"+this.id).attr("height","130%");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",this.styles.graphics.blur.level),a.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var b=a.append("feMerge");b.append("feMergeNode").attr("in","offsetBlur"),b.append("feMergeNode").attr("in","SourceGraphic");var c=this.defs.append("filter").attr("id","drop-shadow"+this.id).attr("height","130%");c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",this.styles.graphics.shadow.level).attr("result","blur"),c.append("feOffset").attr("in","blur").attr("dx",this.styles.graphics.shadow.distance).attr("dy",this.styles.graphics.shadow.distance).attr("result","offsetBlur"),c.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope","0.2");var d=c.append("feMerge");return d.append("feMergeNode").attr("in","offsetBlur").attr("alpha","0.1"),d.append("feMergeNode").attr("in","SourceGraphic"),this},HEXAGRAM.MagicCircle.prototype.run=function(){return this.animation&&"running"==this.animation.status||this.animation.run(),this},HEXAGRAM.MagicCircle.prototype.add=function(a,b){switch(a){case"Space":this.space(b.length);break;case"Ring":this.addRing(b);break;case"CircleRing":this.addCircleRing(b);break;case"Text":this.addText(b);break;default:this.elements.push(a),this.current=a}return this},HEXAGRAM.MagicCircle.prototype.target=function(a){return this.current=a,this.current},HEXAGRAM.MagicCircle.prototype.getLast=function(){return this.current},HEXAGRAM.MagicCircle.prototype.color=function(a){return this.current.recolor?this.current.recolor(a):console.warn("Cant recolor this element",this.current),this},HEXAGRAM.MagicCircle.prototype.fill=function(a){return this.current.fill?this.current.fill(a):console.warn("Cant fill this element",this.current),this},HEXAGRAM.MagicCircle.prototype.rotation=function(a){return this.current.rotation?this.current.rotation(a):console.warn("Cant rotate element",this.current),this},HEXAGRAM.MagicCircle.prototype.on=function(a,b){var c=this.current,d=this;return this.current.on?this.current.on(a,function(){d.current=c,b(d,c)}):console.warn("Can't attach a listener to this object"),this},HEXAGRAM.MagicCircle.prototype.space=function(a){return this.currentRadius+=a,this},HEXAGRAM.MagicCircle.prototype.backspace=function(a){return this.currentRadius-=a,this},HEXAGRAM.MagicCircle.prototype.ring=function(a){var b=this,c=new HEXAGRAM.Ring({parent:b,radius:b.currentRadius,strokeWidth:a||1});return b.elements.push(c),this.current=c,this},HEXAGRAM.MagicCircle.prototype.circleRing=function(a,b,c,d){var e=new HEXAGRAM.CircleRing({parent:this,height:this.height,width:this.width,radius:this.currentRadius+b,count:a,innerRadius:b,speed:c,reverse:d});return this.elements.push(e),this.currentRadius+=2*b,this.current=e,this},HEXAGRAM.MagicCircle.prototype.text=function(a,b,c,d,e){if("autofit"==a){var f=2*this.currentRadius*Math.PI,g=10,h=new HEXAGRAM.TextRing({parent:this,radius:this.currentRadius,text:b,fontSize:g,speed:0,reverse:"0",leading:void 0}),i=h.getLength(),f=2*this.currentRadius*Math.PI,j=f/i,k=g*j;h.disperse(),a=k,e="0"}var l=2,b=new HEXAGRAM.TextRing({parent:this,radius:this.currentRadius+l,text:b,fontSize:a,speed:c||1,reverse:d,leading:e});return this.elements.push(b),this.currentRadius+=a,this.current=b,this},HEXAGRAM.MagicCircle.prototype.disperse=function(){var a=this;$.each(a.elements,function(a,b){b.disperse().then(function(a){a.remove()})}),a.animation.clear(),a.elements=[],a.currentRadius=0,a.caster=null};var MagicCircle=HEXAGRAM.MagicCircle,HEXAGRAM=HEXAGRAM||{};HEXAGRAM.Ring=function(a){var b=this,c=a.parent;return this.circle=c.canvas.append("circle"),this.circle.attr("r",0).attr("cx",c.width/2).attr("cy",c.height/2).attr("opacity",1).attr("stroke",c.styles.colors.ring).attr("fill","none").style("filter","url(#drop-shadow"+c.id+")").attr("stroke-width",a.strokeWidth||a.radius/100),a.strokeWidth>5&&this.circle.style("filter","none"),this.transition=this.circle.transition().duration(c.styles.animation.inSpeed).attr("r",a.radius+a.strokeWidth/2).each("end",function(){b.transition=null}),a.strokeWidth&&(c.currentRadius+=a.strokeWidth),this},HEXAGRAM.Ring.prototype.recolor=function(a){return this.transition=this.transition||this.circle.transition(),"useNone"==a?void this.transition.attr("stroke","rgba(0,0,0,0)").attr("fill-opacity","0.0"):void this.transition.attr("stroke",a)},HEXAGRAM.Ring.prototype.on=function(a,b){this.circle.on(a,b)},HEXAGRAM.Ring.prototype.disperse=function(){var a=Q.defer();return this.circle.transition().duration(parent.styles.animation.inSpeed).attr("opacity",0).attr("r",0).each("end",a.resolve,this.circle),a.promise};var HEXAGRAM=HEXAGRAM||{};HEXAGRAM.TextRing=function(a){var b=this;this.config=a,this.parent=a.parent;var c=0,d=this.parent.id+Math.floor(1e6*Math.random()),e=a.radius,f=-e,g=0,h=this.parent.defs.append("path");h.attr("id","s3"+d).attr("d","m "+f+", "+g+" a -"+e+",-"+e+" 1 1,1 "+2*e+",0 a -"+e+",-"+e+" 1 1,1 -"+2*e+",0"),this.timer=function(){c=a.reverse?c-1*(a.speed||b.parent.styles.animation.animationSpeed):c+1*(a.speed||b.parent.styles.animation.animationSpeed),b.ring.transition().duration(100).ease("linear").attr("transform","translate("+b.parent.width/2+","+b.parent.height/2+")  rotate("+c+")")},this.parent.animation.add(this.timer),this.ring=this.parent.canvas.append("g").attr("id","ring"+d).attr("transform","translate("+this.parent.width/2+","+this.parent.height/2+")  rotate("+c+")").style("pointer-events","none");var i=this.ring.append("text").style("font-size",a.fontSize+"px").attr("xlink:href","#s3"+d).style("text-transform",this.parent.styles.type.typecase).style("filter","url(#drop-shadow"+this.parent.id+")").text(a.text);return this.length=this.ring.select("text").node().getComputedTextLength(),i.remove(),this.text=this.ring.append("text").append("textPath").style("font-size",a.fontSize+"px").attr("xlink:href","#s3"+d).style("letter-spacing",a.leading||this.parent.styles.type.leading).style("text-transform",this.parent.styles.type.typecase).style("pointer-events","none").style("filter","url(#drop-shadow"+this.parent.id+")").text(a.text).attr("fill",this.parent.styles.colors.text).attr("opacity",0),this.transition=this.text.transition().duration(this.parent.styles.animation.inSpeed).ease("linear").attr("opacity",1).each("end",function(){b.transition=null}),this},HEXAGRAM.TextRing.prototype.rotation=function(a){this.parent.animation.remove(this.timer),this.ring.transition().attr("transform","translate("+this.parent.width/2+","+this.parent.height/2+")  rotate("+parseFloat(a+50)+")")},HEXAGRAM.TextRing.prototype.animate=function(){this.parent.animation.add(this.timer)},HEXAGRAM.TextRing.prototype.getLength=function(){return this.length},HEXAGRAM.TextRing.prototype.recolor=function(a){this.transition=this.transition||this.text.transition(),this.transition.attr("fill",a)},HEXAGRAM.TextRing.prototype.disperse=function(){var a=this,b=Q.defer();return this.transition=this.text.transition(),this.transition.attr("opacity",0).each("end",b.resolve,this.text),setTimeout(function(){a.ring.remove(),a.text.remove()},500),b.promise};